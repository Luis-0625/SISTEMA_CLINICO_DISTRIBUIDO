<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPTIMIZACI√ìN - M√©todo de Transporte</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gradient-start: #3498db;
            --gradient-end: #2c3e50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 2rem;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        header {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 1.5rem;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            position: relative;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .card-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-header h2 {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 0.5rem;
            gap: 0.5rem;
        }
        
        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            background: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .tab.active {
            background: var(--secondary-color);
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .input-group {
            display: flex;
            gap: 1rem;
        }
        
        .input-group .form-group {
            flex: 1;
        }
        
        input, select, button {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            font-size: 1rem;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background: linear-gradient(to right, var(--secondary-color), #2980b9);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--secondary-color), #2980b9);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success-color), #219653);
        }
        
        .btn-warning {
            background: linear-gradient(to right, var(--warning-color), #e67e22);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--accent-color), #c0392b);
        }
        
        .matrix-container {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        
        th, td {
            border: 1px solid #dee2e6;
            padding: 0.75rem;
            text-align: center;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .matrix-input {
            width: 70px;
            text-align: center;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .matrix-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .method-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .method-option {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 1rem;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .method-option.active {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .method-option i {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }
        
        .method-option.active i {
            color: var(--secondary-color);
        }
        
        .results {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .step-by-step {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        
        .step {
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 3px solid var(--secondary-color);
        }
        
        .step-number {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 0.5rem;
            font-size: 0.8rem;
        }
        
        .highlight {
            background-color: #fffacd;
            font-weight: bold;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
        }
        
        .optimal {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .warning {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        .info-box {
            background: #e8f4fc;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }
        
        .info-box i {
            color: var(--secondary-color);
            margin-right: 0.5rem;
        }
        
        .footer {
            text-align: center;
            margin-top: 2rem;
            color: white;
            opacity: 0.8;
        }
        
        .stats {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-card {
            flex: 1;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .input-group {
                flex-direction: column;
                gap: 0;
            }
            
            .method-selector {
                flex-direction: column;
            }
            
            .method-option {
                min-width: auto;
            }
            
            .stats {
                flex-direction: column;
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .balance-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }
        
        .balance-info i {
            color: #856404;
            margin-right: 0.5rem;
        }
        
        .balance-info.warning {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        .balance-info.warning i {
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1><i class="fas fa-chart-line"></i> SISTEMA DE OPTIMIZACI√ìN</h1>
            <p>Herramienta avanzada para Modelos de Transporte - Incluye manejo de problemas desbalanceados</p>
        </header>
        
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-cogs"></i> Panel de Control - M√©todo de Transporte</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-calculations">0</div>
                        <div class="stat-label">C√°lculos Realizados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="active-method">-</div>
                        <div class="stat-label">M√©todo Activo</div>
                    </div>
                </div>
            </div>
            
            <div class="card-body">
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>Problema de Transporte:</strong> Determine la distribuci√≥n √≥ptima de productos desde varios or√≠genes a diferentes destinos minimizando los costos totales. El sistema detecta autom√°ticamente problemas desbalanceados y los corrige.
                </div>
                
                <div class="input-group">
                    <div class="form-group">
                        <label for="transport-rows"><i class="fas fa-map-marker-alt"></i> N√∫mero de Or√≠genes:</label>
                        <input type="number" id="transport-rows" min="2" max="10" value="3">
                    </div>
                    
                    <div class="form-group">
                        <label for="transport-cols"><i class="fas fa-flag-checkered"></i> N√∫mero de Destinos:</label>
                        <input type="number" id="transport-cols" min="2" max="10" value="3">
                    </div>
                </div>
                
                <button id="generate-transport-matrix" class="btn-primary pulse">
                    <i class="fas fa-table"></i> Generar Matriz de Costos
                </button>
                
                <div class="matrix-container" id="transport-matrix-container" style="display: none;">
                    <h3><i class="fas fa-th"></i> Matriz de Costos, Ofertas y Demandas</h3>
                    <table id="cost-matrix">
                        <!-- La matriz se generar√° din√°micamente -->
                    </table>
                    
                    <div class="method-selector">
                        <div class="method-option active" data-method="northwest">
                            <i class="fas fa-compass"></i>
                            <span>Esquina Noroeste</span>
                            <small>M√°s simple</small>
                        </div>
                        <div class="method-option" data-method="minimal">
                            <i class="fas fa-search-dollar"></i>
                            <span>Costo M√≠nimo</span>
                            <small>M√°s eficiente</small>
                        </div>
                        <div class="method-option" data-method="vogel">
                            <i class="fas fa-feather-alt"></i>
                            <span>M√©todo de Vogel</span>
                            <small>M√°s preciso</small>
                        </div>
                    </div>
                    
                    <button id="solve-transport" class="btn-success">
                        <i class="fas fa-calculator"></i> Resolver Problema
                    </button>
                    
                    <div id="balance-info" class="balance-info" style="display: none;">
                        <!-- Informaci√≥n sobre balanceo se mostrar√° aqu√≠ -->
                    </div>
                    
                    <div id="transport-results" class="results" style="display: none;">
                        <!-- Los resultados se mostrar√°n aqu√≠ -->
                    </div>
                    
                    <div id="transport-steps" class="step-by-step" style="display: none;">
                        <!-- Los pasos se mostrar√°n aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Sistema de Optimizaci√≥n - M√©todo de Transporte ¬© 2025</p>
        </div>
    </div>

    <script>
        // Variables globales
        let currentTransportMethod = 'northwest';
        let totalCalculations = 0;
        let isBalanced = true;
        let balanceInfo = '';
        
        // Inicializaci√≥n de la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Configuraci√≥n de m√©todos de transporte
            document.querySelectorAll('.method-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.method-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentTransportMethod = this.getAttribute('data-method');
                    updateStats();
                });
            });
            
            // Generar matriz de transporte
            document.getElementById('generate-transport-matrix').addEventListener('click', generateTransportMatrix);
            
            // Resolver problema de transporte
            document.getElementById('solve-transport').addEventListener('click', solveTransportProblem);
            
            // Actualizar estad√≠sticas iniciales
            updateStats();
        });
        
        // Actualizar estad√≠sticas
        function updateStats() {
            document.getElementById('total-calculations').textContent = totalCalculations;
            document.getElementById('active-method').textContent = getMethodName(currentTransportMethod);
        }
        
        // Generar matriz de transporte
        function generateTransportMatrix() {
            const rows = parseInt(document.getElementById('transport-rows').value);
            const cols = parseInt(document.getElementById('transport-cols').value);
            
            // Generar matriz de costos con estructura de ORIGEN/DESTINO
            let costMatrixHtml = '<tr><th>ORIGEN / DESTINO</th>';
            for (let j = 0; j < cols; j++) {
                costMatrixHtml += `<th>DESTINO ${j+1}</th>`;
            }
            costMatrixHtml += '<th>OFERTA</th></tr>';
            
            for (let i = 0; i < rows; i++) {
                costMatrixHtml += `<tr><th>ORIGEN ${i+1}</th>`;
                for (let j = 0; j < cols; j++) {
                    costMatrixHtml += `<td><input type="number" class="matrix-input" id="cost-${i}-${j}" value="${Math.floor(Math.random() * 10) + 1}" min="0"></td>`;
                }
                costMatrixHtml += `<td><input type="number" class="matrix-input" id="supply-${i}" value="${Math.floor(Math.random() * 100) + 50}" min="1"></td>`;
                costMatrixHtml += '</tr>';
            }
            
            costMatrixHtml += '<tr><th>DEMANDA</th>';
            for (let j = 0; j < cols; j++) {
                costMatrixHtml += `<td><input type="number" class="matrix-input" id="demand-${j}" value="${Math.floor(Math.random() * 100) + 50}" min="1"></td>`;
            }
            costMatrixHtml += '<td></td></tr>';
            
            document.getElementById('cost-matrix').innerHTML = costMatrixHtml;
            document.getElementById('transport-matrix-container').style.display = 'block';
            
            // Agregar efecto visual
            const container = document.getElementById('transport-matrix-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                container.style.transition = 'all 0.5s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);
        }
        
        // Verificar si el problema est√° balanceado
        function checkBalance(supply, demand) {
            const totalSupply = supply.reduce((a, b) => a + b, 0);
            const totalDemand = demand.reduce((a, b) => a + b, 0);
            
            if (totalSupply === totalDemand) {
                isBalanced = true;
                balanceInfo = `<i class="fas fa-check-circle"></i> El problema est√° <strong>balanceado</strong>. Oferta total (${totalSupply}) = Demanda total (${totalDemand})`;
                return { balanced: true, difference: 0 };
            } else if (totalSupply > totalDemand) {
                isBalanced = false;
                const difference = totalSupply - totalDemand;
                balanceInfo = `<i class="fas fa-exclamation-triangle"></i> El problema est√° <strong>desequilibrado</strong>. Oferta total (${totalSupply}) > Demanda total (${totalDemand}). Se agregar√° un <strong>destino ficticio</strong> con demanda = ${difference} y costos = 0.`;
                return { balanced: false, difference, type: 'supply' };
            } else {
                isBalanced = false;
                const difference = totalDemand - totalSupply;
                balanceInfo = `<i class="fas fa-exclamation-triangle"></i> El problema est√° <strong>desequilibrado</strong>. Oferta total (${totalSupply}) < Demanda total (${totalDemand}). Se agregar√° un <strong>origen ficticio</strong> con oferta = ${difference} y costos = 0.`;
                return { balanced: false, difference, type: 'demand' };
            }
        }
        
        // Balancear el problema
        function balanceProblem(supply, demand, costs) {
            const balanceCheck = checkBalance(supply, demand);
            
            if (balanceCheck.balanced) {
                return { supply, demand, costs, balanced: true };
            }
            
            let balancedSupply = [...supply];
            let balancedDemand = [...demand];
            let balancedCosts = costs.map(row => [...row]);
            
            if (balanceCheck.type === 'supply') {
                // Agregar destino ficticio
                balancedDemand.push(balanceCheck.difference);
                for (let i = 0; i < balancedCosts.length; i++) {
                    balancedCosts[i].push(0); // Costo 0 para destino ficticio
                }
            } else {
                // Agregar origen ficticio
                balancedSupply.push(balanceCheck.difference);
                const newRow = Array(balancedDemand.length).fill(0); // Costo 0 para origen ficticio
                balancedCosts.push(newRow);
            }
            
            return { 
                supply: balancedSupply, 
                demand: balancedDemand, 
                costs: balancedCosts, 
                balanced: false,
                balanceInfo: balanceCheck
            };
        }
        
        // Resolver problema de transporte - MEJORADO
        function solveTransportProblem() {
            const button = document.getElementById('solve-transport');
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div> Calculando...';
            button.disabled = true;
            
            setTimeout(() => {
                try {
                    const rows = parseInt(document.getElementById('transport-rows').value);
                    const cols = parseInt(document.getElementById('transport-cols').value);
                    
                    // Obtener datos de la matriz de costos
                    const costs = [];
                    for (let i = 0; i < rows; i++) {
                        costs[i] = [];
                        for (let j = 0; j < cols; j++) {
                            const value = document.getElementById(`cost-${i}-${j}`).value;
                            costs[i][j] = parseInt(value) || 0;
                        }
                    }
                    
                    // Obtener ofertas y demandas
                    const supply = [];
                    for (let i = 0; i < rows; i++) {
                        const value = document.getElementById(`supply-${i}`).value;
                        supply[i] = parseInt(value) || 0;
                    }
                    
                    const demand = [];
                    for (let j = 0; j < cols; j++) {
                        const value = document.getElementById(`demand-${j}`).value;
                        demand[j] = parseInt(value) || 0;
                    }
                    
                    // Validar datos
                    if (supply.some(s => s <= 0) || demand.some(d => d <= 0)) {
                        alert("‚ùå Error: Todas las ofertas y demandas deben ser mayores a 0");
                        button.innerHTML = originalText;
                        button.disabled = false;
                        return;
                    }
                    
                    // Verificar y balancear el problema si es necesario
                    const balancedProblem = balanceProblem(supply, demand, costs);
                    
                    // Mostrar informaci√≥n de balanceo
                    const balanceInfoElement = document.getElementById('balance-info');
                    balanceInfoElement.innerHTML = balanceInfo;
                    balanceInfoElement.className = balancedProblem.balanced ? 'balance-info' : 'balance-info warning';
                    balanceInfoElement.style.display = 'block';
                    
                    // Resolver seg√∫n el m√©todo seleccionado
                    let solution, steps, totalCost;
                    
                    switch(currentTransportMethod) {
                        case 'northwest':
                            ({solution, steps, totalCost} = northwestCorner(balancedProblem.supply, balancedProblem.demand, balancedProblem.costs));
                            break;
                        case 'minimal':
                            ({solution, steps, totalCost} = minimalCost(balancedProblem.supply, balancedProblem.demand, balancedProblem.costs));
                            break;
                        case 'vogel':
                            ({solution, steps, totalCost} = vogelApproximation(balancedProblem.supply, balancedProblem.demand, balancedProblem.costs));
                            break;
                    }
                    
                    // Mostrar resultados
                    displayTransportResults(solution, totalCost, steps, balancedProblem);
                    
                    // Actualizar estad√≠sticas
                    totalCalculations++;
                    updateStats();
                    
                } catch (error) {
                    console.error("Error al resolver:", error);
                    alert("‚ùå Error al resolver el problema: " + error.message);
                } finally {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }, 500);
        }
        
        // M√©todo de la Esquina Noroeste
        function northwestCorner(supply, demand, costs) {
            const rows = supply.length;
            const cols = demand.length;
            const solution = Array(rows).fill().map(() => Array(cols).fill(0));
            const steps = [];
            let totalCost = 0;
            
            let i = 0, j = 0;
            let remainingSupply = [...supply];
            let remainingDemand = [...demand];
            
            steps.push("üöÄ Iniciando m√©todo de la esquina noroeste...");
            
            while (i < rows && j < cols) {
                const allocation = Math.min(remainingSupply[i], remainingDemand[j]);
                solution[i][j] = allocation;
                totalCost += allocation * costs[i][j];
                
                remainingSupply[i] -= allocation;
                remainingDemand[j] -= allocation;
                
                steps.push(`üì¶ Asignando ${allocation} unidades de Origen ${i+1} a Destino ${j+1} (costo: ${costs[i][j]})`);
                
                if (remainingSupply[i] === 0) {
                    i++;
                    if (i < rows) {
                        steps.push(`‚ÜòÔ∏è Oferta del Origen ${i} agotada, moviendo al siguiente origen.`);
                    }
                } else {
                    j++;
                    if (j < cols) {
                        steps.push(`‚û°Ô∏è Demanda del Destino ${j} satisfecha, moviendo al siguiente destino.`);
                    }
                }
            }
            
            steps.push(`‚úÖ Soluci√≥n completa. Costo total: ${totalCost}`);
            
            return {solution, steps, totalCost};
        }
        
        // M√©todo del Costo M√≠nimo
        function minimalCost(supply, demand, costs) {
            const rows = supply.length;
            const cols = demand.length;
            const solution = Array(rows).fill().map(() => Array(cols).fill(0));
            const steps = [];
            let totalCost = 0;
            
            let remainingSupply = [...supply];
            let remainingDemand = [...demand];
            
            steps.push("üöÄ Iniciando m√©todo del costo m√≠nimo...");
            
            while (true) {
                // Encontrar la celda con el costo m√≠nimo
                let minCost = Infinity;
                let minI = -1, minJ = -1;
                
                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        if (remainingSupply[i] > 0 && remainingDemand[j] > 0 && costs[i][j] < minCost) {
                            minCost = costs[i][j];
                            minI = i;
                            minJ = j;
                        }
                    }
                }
                
                // Si no hay m√°s celdas disponibles, terminar
                if (minI === -1) break;
                
                // Asignar la cantidad m√°xima posible
                const allocation = Math.min(remainingSupply[minI], remainingDemand[minJ]);
                solution[minI][minJ] = allocation;
                totalCost += allocation * costs[minI][minJ];
                
                steps.push(`üí∞ Asignando ${allocation} unidades de Origen ${minI+1} a Destino ${minJ+1} (costo m√≠nimo: ${costs[minI][minJ]})`);
                
                remainingSupply[minI] -= allocation;
                remainingDemand[minJ] -= allocation;
                
                // Verificar si hemos terminado
                const hasSupply = remainingSupply.some(s => s > 0);
                const hasDemand = remainingDemand.some(d => d > 0);
                
                if (!hasSupply || !hasDemand) break;
            }
            
            steps.push(`‚úÖ Soluci√≥n completa. Costo total: ${totalCost}`);
            
            return {solution, steps, totalCost};
        }
        
        // M√©todo de Vogel
        function vogelApproximation(supply, demand, costs) {
            const rows = supply.length;
            const cols = demand.length;
            const solution = Array(rows).fill().map(() => Array(cols).fill(0));
            const steps = [];
            let totalCost = 0;
            
            let remainingSupply = [...supply];
            let remainingDemand = [...demand];
            
            steps.push("üöÄ Iniciando m√©todo de Vogel...");
            
            let iteration = 1;
            
            while (true) {
                steps.push(`--- Iteraci√≥n ${iteration} ---`);
                
                // Calcular penalizaciones para filas
                const rowPenalties = [];
                for (let i = 0; i < rows; i++) {
                    if (remainingSupply[i] > 0) {
                        const rowCosts = [];
                        for (let j = 0; j < cols; j++) {
                            if (remainingDemand[j] > 0) {
                                rowCosts.push(costs[i][j]);
                            }
                        }
                        if (rowCosts.length >= 2) {
                            rowCosts.sort((a, b) => a - b);
                            rowPenalties[i] = rowCosts[1] - rowCosts[0];
                        } else if (rowCosts.length === 1) {
                            rowPenalties[i] = rowCosts[0];
                        } else {
                            rowPenalties[i] = -1;
                        }
                    } else {
                        rowPenalties[i] = -1;
                    }
                }
                
                // Calcular penalizaciones para columnas
                const colPenalties = [];
                for (let j = 0; j < cols; j++) {
                    if (remainingDemand[j] > 0) {
                        const colCosts = [];
                        for (let i = 0; i < rows; i++) {
                            if (remainingSupply[i] > 0) {
                                colCosts.push(costs[i][j]);
                            }
                        }
                        if (colCosts.length >= 2) {
                            colCosts.sort((a, b) => a - b);
                            colPenalties[j] = colCosts[1] - colCosts[0];
                        } else if (colCosts.length === 1) {
                            colPenalties[j] = colCosts[0];
                        } else {
                            colPenalties[j] = -1;
                        }
                    } else {
                        colPenalties[j] = -1;
                    }
                }
                
                // Encontrar la m√°xima penalizaci√≥n
                let maxPenalty = -1;
                let isRow = true;
                let index = -1;
                
                for (let i = 0; i < rows; i++) {
                    if (rowPenalties[i] > maxPenalty) {
                        maxPenalty = rowPenalties[i];
                        isRow = true;
                        index = i;
                    }
                }
                
                for (let j = 0; j < cols; j++) {
                    if (colPenalties[j] > maxPenalty) {
                        maxPenalty = colPenalties[j];
                        isRow = false;
                        index = j;
                    }
                }
                
                // Si no hay m√°s penalizaciones v√°lidas, terminar
                if (maxPenalty === -1) {
                    steps.push("üõë No hay m√°s penalizaciones v√°lidas. Terminando...");
                    break;
                }
                
                steps.push(`üìä M√°xima penalizaci√≥n: ${maxPenalty} (${isRow ? 'Fila' : 'Columna'} ${index+1})`);
                
                // Encontrar la celda con el costo m√≠nimo en la fila o columna con m√°xima penalizaci√≥n
                let minCost = Infinity;
                let minI = -1, minJ = -1;
                
                if (isRow) {
                    const i = index;
                    for (let j = 0; j < cols; j++) {
                        if (remainingSupply[i] > 0 && remainingDemand[j] > 0 && costs[i][j] < minCost) {
                            minCost = costs[i][j];
                            minI = i;
                            minJ = j;
                        }
                    }
                } else {
                    const j = index;
                    for (let i = 0; i < rows; i++) {
                        if (remainingSupply[i] > 0 && remainingDemand[j] > 0 && costs[i][j] < minCost) {
                            minCost = costs[i][j];
                            minI = i;
                            minJ = j;
                        }
                    }
                }
                
                // Verificar si se encontr√≥ una celda v√°lida
                if (minI === -1 || minJ === -1) {
                    steps.push("üõë No se encontr√≥ celda v√°lida. Terminando...");
                    break;
                }
                
                // Asignar la cantidad m√°xima posible
                const allocation = Math.min(remainingSupply[minI], remainingDemand[minJ]);
                solution[minI][minJ] += allocation;
                totalCost += allocation * costs[minI][minJ];
                
                steps.push(`üì¶ Asignando ${allocation} unidades de Origen ${minI+1} a Destino ${minJ+1} (costo: ${costs[minI][minJ]})`);
                
                remainingSupply[minI] -= allocation;
                remainingDemand[minJ] -= allocation;
                
                steps.push(`üìä Oferta restante Origen ${minI+1}: ${remainingSupply[minI]}`);
                steps.push(`üìä Demanda restante Destino ${minJ+1}: ${remainingDemand[minJ]}`);
                
                // Verificar si hemos terminado
                const hasSupply = remainingSupply.some(s => s > 0);
                const hasDemand = remainingDemand.some(d => d > 0);
                
                if (!hasSupply || !hasDemand) {
                    steps.push("‚úÖ Toda la oferta o demanda ha sido asignada. Terminando...");
                    break;
                }
                
                iteration++;
                
                // Prevenir bucles infinitos
                if (iteration > rows * cols * 2) {
                    steps.push("‚ö†Ô∏è Se alcanz√≥ el l√≠mite de iteraciones. Verificar los datos.");
                    break;
                }
            }
            
            // Verificar soluci√≥n completa
            const assignedSupply = solution.reduce((sum, row) => sum + row.reduce((a, b) => a + b, 0), 0);
            steps.push(`‚úÖ Soluci√≥n completa. Total asignado: ${assignedSupply}, Costo total: ${totalCost}`);
            
            return {solution, steps, totalCost};
        }
        
        // Mostrar resultados del problema de transporte
        function displayTransportResults(solution, totalCost, steps, balancedProblem) {
            const rows = solution.length;
            const cols = solution[0].length;
            
            // Mostrar tabla de soluci√≥n
            let resultsHtml = `<h3><i class="fas fa-check-circle"></i> Soluci√≥n por el M√©todo ${getMethodName(currentTransportMethod)}</h3>`;
            
            // Indicar si el problema fue balanceado
            if (!balancedProblem.balanced) {
                if (balancedProblem.balanceInfo.type === 'supply') {
                    resultsHtml += `<p class="warning"><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Se agreg√≥ un destino ficticio (columna ${cols}) para balancear el problema</p>`;
                } else {
                    resultsHtml += `<p class="warning"><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Se agreg√≥ un origen ficticio (fila ${rows}) para balancear el problema</p>`;
                }
            }
            
            resultsHtml += `<p class="optimal"><i class="fas fa-dollar-sign"></i> <strong>Costo Total: ${totalCost}</strong></p>`;
            resultsHtml += '<div class="matrix-container"><table><tr><th>ORIGEN / DESTINO</th>';
            
            for (let j = 0; j < cols; j++) {
                // Marcar destino ficticio
                const isFictitious = !balancedProblem.balanced && balancedProblem.balanceInfo.type === 'supply' && j === cols - 1;
                resultsHtml += `<th>${isFictitious ? 'FICTICIO' : 'DESTINO'} ${j+1}</th>`;
            }
            resultsHtml += '<th>OFERTA</th></tr>';
            
            for (let i = 0; i < rows; i++) {
                // Marcar origen ficticio
                const isFictitious = !balancedProblem.balanced && balancedProblem.balanceInfo.type === 'demand' && i === rows - 1;
                resultsHtml += `<tr><th>${isFictitious ? 'FICTICIO' : 'ORIGEN'} ${i+1}</th>`;
                for (let j = 0; j < cols; j++) {
                    if (solution[i][j] > 0) {
                        resultsHtml += `<td class="highlight">${solution[i][j]}</td>`;
                    } else {
                        resultsHtml += `<td>${solution[i][j]}</td>`;
                    }
                }
                resultsHtml += `<td>${solution[i].reduce((a, b) => a + b, 0)}</td>`;
                resultsHtml += '</tr>';
            }
            
            resultsHtml += '<tr><th>DEMANDA</th>';
            for (let j = 0; j < cols; j++) {
                let colSum = 0;
                for (let i = 0; i < rows; i++) {
                    colSum += solution[i][j];
                }
                resultsHtml += `<td>${colSum}</td>`;
            }
            resultsHtml += '<td></td></tr>';
            
            resultsHtml += '</table></div>';
            
            document.getElementById('transport-results').innerHTML = resultsHtml;
            document.getElementById('transport-results').style.display = 'block';
            
            // Mostrar pasos
            let stepsHtml = '<h3><i class="fas fa-list-ol"></i> Paso a Paso</h3>';
            steps.forEach((step, index) => {
                stepsHtml += `<div class="step"><span class="step-number">${index+1}</span> ${step}</div>`;
            });
            
            document.getElementById('transport-steps').innerHTML = stepsHtml;
            document.getElementById('transport-steps').style.display = 'block';
            
            // Efectos visuales
            const results = document.getElementById('transport-results');
            const stepsContainer = document.getElementById('transport-steps');
            
            results.style.opacity = '0';
            stepsContainer.style.opacity = '0';
            
            setTimeout(() => {
                results.style.transition = 'all 0.5s ease';
                results.style.opacity = '1';
                
                setTimeout(() => {
                    stepsContainer.style.transition = 'all 0.5s ease';
                    stepsContainer.style.opacity = '1';
                }, 300);
            }, 100);
        }
        
        // Obtener nombre del m√©todo
        function getMethodName(method) {
            switch(method) {
                case 'northwest': return 'Esquina Noroeste';
                case 'minimal': return 'Costo M√≠nimo';
                case 'vogel': return 'Vogel';
                default: return '';
            }
        }
    </script>
</body>
</html>